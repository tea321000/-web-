(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bc27249c"],{"0670":function(e,t,o){},"13b2":function(e,t,o){"use strict";var l=o("0670"),r=o.n(l);r.a},"29c8":function(e,t,o){"use strict";o.r(t);var l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("Vote")],1)},r=[],s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",["student"===e.roles?o("h3",[e._v("您是学生，无权查看此页")]):e._e(),o("el-form",{ref:"voteForm",attrs:{model:e.voteForm,"label-width":"80px","auto-complete":"on",rules:e.voteRules}},[o("el-form-item",{attrs:{label:"活动主题",prop:"theme"}},[o("el-input",{attrs:{name:"theme",type:"text"},model:{value:e.voteForm.theme,callback:function(t){e.$set(e.voteForm,"theme",t)},expression:"voteForm.theme"}})],1),o("el-form-item",{attrs:{label:"活动内容"}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.voteForm.content,callback:function(t){e.$set(e.voteForm,"content",t)},expression:"voteForm.content"}})],1),o("el-form-item",{attrs:{label:"活动图片"}},[o("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://www.yourdomain.xyz:yourport/vote/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.imageUrl?o("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):o("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),o("el-form-item",{attrs:{label:"开始时间"}},[o("el-col",{attrs:{span:24}},[o("el-date-picker",{ref:"startDate1",staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},model:{value:e.voteForm.startDate1,callback:function(t){e.$set(e.voteForm,"startDate1",t)},expression:"voteForm.startDate1"}})],1),o("el-col",{attrs:{span:24}},[o("el-time-picker",{ref:"startDate2",staticStyle:{width:"100%"},attrs:{placeholder:"选择时间","value-format":"HH:mm:ss",format:"HH:mm:ss"},model:{value:e.voteForm.startDate2,callback:function(t){e.$set(e.voteForm,"startDate2",t)},expression:"voteForm.startDate2"}})],1)],1),o("el-form-item",{attrs:{label:"结束时间",prop:"endDate"}},[o("el-col",{attrs:{span:24}},[o("el-date-picker",{ref:"endDate1",staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},model:{value:e.voteForm.endDate1,callback:function(t){e.$set(e.voteForm,"endDate1",t)},expression:"voteForm.endDate1"}})],1),o("el-col",{attrs:{span:24}},[o("el-time-picker",{ref:"endDate2",staticStyle:{width:"100%"},attrs:{placeholder:"选择时间","value-format":"HH:mm:ss",format:"HH:mm:ss"},model:{value:e.voteForm.endDate2,callback:function(t){e.$set(e.voteForm,"endDate2",t)},expression:"voteForm.endDate2"}})],1)],1),o("el-form-item",{attrs:{label:"单选/多选"}},[o("el-switch",{ref:"selectedMode",model:{value:e.voteForm.selectMode,callback:function(t){e.$set(e.voteForm,"selectMode",t)},expression:"voteForm.selectMode"}})],1),!0===e.voteForm.selectMode?o("el-form-item",{attrs:{label:"多选",prop:"selected"}},[o("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入组别_选项"},model:{value:e.tmpInput,callback:function(t){e.tmpInput=t},expression:"tmpInput"}},[o("el-button",{attrs:{slot:"append",icon:"el-icon-circle-plus-outline"},on:{click:e.onMultipleSelected},slot:"append"})],1),o("el-checkbox-group",{ref:"multipleSelected"},e._l(e.voteForm.multipleSelected,function(t,l){return o("div",[o("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-delete"},on:{click:function(t){return e.deleteMutipleOption(l)}}}),o("el-checkbox",{attrs:{label:t,name:"type"}})],1)}),0)],1):!1===e.voteForm.selectMode?o("el-form-item",{attrs:{label:"单选",prop:"selected"}},[o("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入组别_选项"},model:{value:e.tmpInput,callback:function(t){e.tmpInput=t},expression:"tmpInput"}},[o("el-button",{attrs:{slot:"append",icon:"el-icon-circle-plus-outline"},on:{click:e.onSingleSelected},slot:"append"})],1),o("el-radio-group",{ref:"singleSelected"},e._l(e.voteForm.singleSelected,function(t,l){return o("div",[o("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-delete"},on:{click:function(t){return e.deleteSingleOption(l)}}}),o("el-radio",{attrs:{label:t}})],1)}),0)],1):e._e(),o("el-form-item",{attrs:{label:"筛选"}},[o("el-radio-group",{model:{value:e.voteForm.filter,callback:function(t){e.$set(e.voteForm,"filter",t)},expression:"voteForm.filter"}},[o("el-radio",{attrs:{label:"全校",disabled:e.radio_disabled}}),o("el-radio",{attrs:{label:"学院"}}),o("el-radio",{attrs:{label:"年级"}}),o("el-radio",{attrs:{label:"个人"}})],1)],1),"学院"===e.voteForm.filter?o("el-form-item",{attrs:{label:"学院"}},[o("el-checkbox-group",{model:{value:e.voteForm.selectedAcademy,callback:function(t){e.$set(e.voteForm,"selectedAcademy",t)},expression:"voteForm.selectedAcademy"}},e._l(e.academy,function(e){return o("el-checkbox",{key:e.id,attrs:{label:e,name:"type"}})}),1)],1):"年级"===e.voteForm.filter?o("el-form-item",{attrs:{label:"年级"}},[o("el-checkbox-group",{model:{value:e.voteForm.selectedGrade,callback:function(t){e.$set(e.voteForm,"selectedGrade",t)},expression:"voteForm.selectedGrade"}},e._l(e.grade,function(e){return o("el-checkbox",{key:e.id,attrs:{label:e,name:"type"}})}),1)],1):"个人"===e.voteForm.filter?o("el-form-item",{attrs:{label:"个人"}},[o("el-input",{attrs:{placeholder:"请输入查询的个人"},model:{value:e.person_filter,callback:function(t){e.person_filter=t},expression:"person_filter"}}),0===e.person_filter.length?o("el-checkbox-group",{model:{value:e.voteForm.selectedPerson,callback:function(t){e.$set(e.voteForm,"selectedPerson",t)},expression:"voteForm.selectedPerson"}},e._l(e.person,function(e){return o("el-checkbox",{key:e.id,attrs:{label:e,name:"type"}})}),1):o("el-checkbox-group",{model:{value:e.voteForm.selectedPerson,callback:function(t){e.$set(e.voteForm,"selectedPerson",t)},expression:"voteForm.selectedPerson"}},e._l(e.personFilterResult,function(e){return o("el-checkbox",{key:e.id,attrs:{label:e,name:"type"}})}),1)],1):e._e(),o("el-form-item",{attrs:{label:"是否匿名"}},[o("el-switch",{model:{value:e.voteForm.anonymous,callback:function(t){e.$set(e.voteForm,"anonymous",t)},expression:"voteForm.anonymous"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleVote(t)}}},[e._v("立即创建")])],1)],1)],1)},a=[],n=o("61f7"),i=o("5c96"),c=new Date,d={created(){this.$store.dispatch("user/getStudents").then(()=>{Object(i["Message"])({message:"成功获取学生信息",type:"success",duration:2e3}),this.person=this.$store.state.user.students}).catch(()=>{Object(i["Message"])({message:"无法获取学生信息",type:"error",duration:2e3})})},data(){const e=(e,t,o)=>{Object(n["b"])(t)?o():o(new Error("请输入主题"))},t=(e,t,o)=>{Object(n["c"])(this.$refs.startDate1.$children[0].$options.propsData.value,this.$refs.startDate2.$children[0].$options.propsData.value,this.$refs.endDate1.$children[0].$options.propsData.value,this.$refs.endDate2.$children[0].$options.propsData.value)?o():o(new Error("请输入正确的结束日期"))},o=(e,t,o)=>{this.$refs.selectedMode.$options.propsData.value?Object(n["g"])(this.$refs.multipleSelected.$children.length)?o():o(new Error("请输入超过两个选项！")):Object(n["g"])(this.$refs.singleSelected.$children.length)?o():o(new Error("请输入超过两个选项！"))};return{roles:this.$store.state.user.roles[0],voteForm:{theme:"",startDate1:c.toLocaleDateString(),startDate2:c.toLocaleTimeString("chinese",{hour12:!1}),endDate1:"",endDate2:"",selectMode:!1,anonymous:!1,filter:"全校",selectedAcademy:[],selectedGrade:[],selectedPerson:[],content:"",image:"",multipleSelected:[],singleSelected:[]},voteRules:{theme:[{required:!0,trigger:"blur",validator:e}],endDate:[{required:!0,trigger:"blur",validator:t}],selected:[{required:!0,trigger:"blur",validator:o}]},academy:["机电工程学院","信息与通信学院","计算机与信息安全学院","艺术与设计学院","商学院","外国语学院","数学与计算科学学院","电子工程与自动化学院"],grade:[2015,2016,2017,2018],person:[],previewImage:"",tmpInput:"",imageUrl:"",person_filter:"",personFilterResult:[]}},computed:{radio_disabled(){return 0!==this.voteForm.selectedAcademy.length||0!==this.voteForm.selectedGrade.length||0!==this.voteForm.selectedPerson.length}},watch:{person_filter:function(e,t){this.personFilter()}},methods:{deleteMutipleOption(e){this.voteForm.multipleSelected.splice(e,1)},deleteSingleOption(e){this.voteForm.singleSelected.splice(e,1)},personFilter(){for(var e of(this.personFilterResult=[],this.person))e.indexOf(this.person_filter)>-1&&this.personFilterResult.push(e)},onMultipleSelected(){this.tmpInput&&this.voteForm.multipleSelected.push(this.tmpInput)},onSingleSelected(){this.tmpInput&&this.voteForm.singleSelected.push(this.tmpInput)},handleAvatarSuccess(e,t){this.voteForm.image=e["link"],this.imageUrl=URL.createObjectURL(t.raw)},beforeAvatarUpload(e){const t="image/jpeg"===e.type,o=e.size/1024/1024<2;return t||this.$message.error("上传图片只能是 JPG 格式!"),o||this.$message.error("上传图片大小不能超过 2MB!"),t&&o},handleVote(){this.$refs.voteForm.validate(e=>{if(!e)return console.log("错误的提交！"),!1;this.loading=!0,this.$store.dispatch("user/createVote",this.voteForm).then(()=>{this.$router.push({name:"IndexPermission"}),this.loading=!1,Object(i["Message"])({message:"新建投票成功",type:"success",duration:5e3})}).catch(()=>{this.loading=!1,Object(i["Message"])({message:"新建投票失败，请检查‘组别_选项’格式是否正确",type:"error",duration:5e3})})})}}},m=d,p=(o("13b2"),o("2877")),u=Object(p["a"])(m,s,a,!1,null,"01a10ca5",null),v=u.exports,h={name:"vote",components:{Vote:v}},f=h,b=Object(p["a"])(f,l,r,!1,null,null,null);t["default"]=b.exports}}]);
//# sourceMappingURL=chunk-bc27249c.c7557696.js.map