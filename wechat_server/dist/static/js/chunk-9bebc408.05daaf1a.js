(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9bebc408"],{"3e4a":function(e,t,a){"use strict";var i=a("85ae"),s=a.n(i);s.a},"85ae":function(e,t,a){},9158:function(e,t,a){"use strict";function i(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));let a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(let i in a){let e=a[i]+"";new RegExp(`(${i})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?e:s(e)))}return t}function s(e){return("00"+e).substr(e.length)}a.d(t,"a",function(){return i})},c84b:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Detail")],1)},s=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"当前状态",name:"1"}},[!0===e.data.permission&&!0===e.data.time_limit&&"student"===e.roles[0]?a("div",[e._v("可以进行投票")]):"teacher"===e.roles[0]?a("div",[e._v("您是老师，不可进行投票")]):!1===e.data.permission?a("div",[e._v("您没有该投票的权限或已经投过票，不可投票")]):!1===e.data.time_limit?a("div",[e._v("投票时间已过或未开始，不可投票")]):e._e(),e.data.academy?a("div",[e._v("投票限制学院为：")]):e._e(),e._l(e.data.academy,function(t){return a("div",{key:t},[e._v(e._s(t))])}),e.data.grade?a("div",[e._v("投票限制年级为：")]):e._e(),e._l(e.data.grade,function(t){return a("div",{key:t},[e._v(e._s(t))])}),e.data.person?a("div",[e._v("投票限制个人为：")]):e._e(),e._l(e.data.person,function(t){return a("div",{key:t},[e._v(e._s(t))])}),e.data.anonymous?a("div",[e._v("该投票是匿名投票，将不显示投票历史")]):e._e()],2),a("el-collapse-item",{attrs:{title:"投票标题",name:"2"}},[a("div",[e._v(e._s(e.data.title))])]),e.data.content?a("el-collapse-item",{attrs:{title:"投票内容",name:"3"}},[a("div",[e._v(e._s(e.data.content))])]):e._e(),a("el-collapse-item",{attrs:{title:"投票时间",name:"4"}},[a("div",[e._v(e._s(e._f("formatDate")(e.data.time_start))+"至"+e._s(e._f("formatDate")(e.data.time_end)))])]),e.data.pic?a("el-collapse-item",{attrs:{title:"投票图片",name:"5"}},[a("img",{staticClass:"image",attrs:{src:e.data.pic}})]):e._e(),a("el-collapse-item",{attrs:{title:"投票链接和二维码",name:"6"}},[a("div",[e._v("投票地址链接为:")]),a("a",{attrs:{href:e.qrLink}},[e._v(e._s(e.qrLink))]),a("div",[e._v("二维码:")]),a("qrcode",{attrs:{value:e.qrLink,options:{width:300}}})],1),!1===e.data.anonymous&&e.data.history.length>0?a("el-collapse-item",{attrs:{title:"投票历史",name:"7"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"投票者学号:"}},[a("span",[e._v(e._s(t.row.user_id))])]),a("el-form-item",{attrs:{label:"投票者姓名:"}},[a("span",[e._v(e._s(t.row.user_name))])]),a("el-form-item",{attrs:{label:"投票选项:"}},[a("span",[e._v(e._s(t.row.vote_content))])]),a("el-form-item",{attrs:{label:"当前该选项票数:"}},[a("span",[e._v(e._s(t.row.vote_count))])])],1)]}}],null,!1,1805806008)}),a("el-table-column",{attrs:{label:"投票者学号",prop:"user_id"}}),a("el-table-column",{attrs:{label:"投票者姓名",prop:"user_name"}})],1)],1):e._e(),a("el-collapse-item",{attrs:{title:"投票选项及图表",name:"8"}},[a("el-collapse",{attrs:{accordion:""},model:{value:e.optionActiveName,callback:function(t){e.optionActiveName=t},expression:"optionActiveName"}},e._l(e.data.group,function(t,i){return a("el-collapse-item",{attrs:{title:t,name:i}},[!1===e.data.multiple?a("div",[!0===e.data.permission&&!0===e.data.time_limit?a("el-radio-group",{model:{value:e.choice[i],callback:function(t){e.$set(e.choice,i,t)},expression:"choice[index]"}},e._l(e.filter_option(t),function(t){return a("el-radio",{key:t.key,attrs:{label:t.key}},[e._v(e._s(t.option.name)+" 投票数量："+e._s(t.option.value))])}),1):a("el-radio-group",e._l(e.filter_option(t),function(t,i){return a("el-radio",{attrs:{disable:"",label:i}},[e._v(e._s(t.option.name)+" 投票数量："+e._s(t.option.value))])}),1)],1):a("div",[!0===e.data.permission&&!0===e.data.time_limit?a("el-checkbox-group",{model:{value:e.choice[i],callback:function(t){e.$set(e.choice,i,t)},expression:"choice[index]"}},e._l(e.filter_option(t),function(t){return a("el-checkbox",{key:t.key,attrs:{label:t.key}},[e._v(e._s(t.option.name)+" 投票数量："+e._s(t.option.value))])}),1):a("el-checkbox-group",e._l(e.filter_option(t),function(t,i){return a("el-checkbox",{attrs:{disable:"",label:i}},[e._v(e._s(t.option.name)+" 投票数量："+e._s(t.option.value))])}),1)],1)])}),1),!0===e.data.permission&&!0===e.data.time_limit?a("el-button",{attrs:{type:"primary",disabled:e.submitDisabled},on:{click:e.handleVote}},[e._v("提交")]):e._e(),a("v-chart",{ref:"pie",staticStyle:{width:"100%",height:"100%","min-width":"300px","min-height":"600px"},attrs:{options:e.chart_option,autoresize:""}}),a("el-select",{key:e.$route.params.id,attrs:{placeholder:"请选择要显示的组别"},on:{change:e.handleSelected},model:{value:e.selectedValue,callback:function(t){e.selectedValue=t},expression:"selectedValue"}},e._l(e.data.group,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1)},l=[],r=a("5c96"),n=a("9158"),c=a("9ca8"),d=(a("c037"),{name:"detail",components:{"v-chart":c["a"]},created(){this.detailStatic()},data(){return{data:[],tableData:[],qrLink:window.location.href,activeNames:["1","2","3","4","5","6","7","8"],optionActiveName:"1",roles:this.$store.state.user.roles,choice:[],submitDisabled:!1,selectedValue:"",chart_option:{},chart_template:{title:{text:"投票图表",subtext:"",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:[]},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"投票图表",type:"pie",radius:"55%",center:["50%","60%"],data:[]}]}}},watch:{$route(e,t){"voteDetailPermission"===e.name&&this.detailStatic()}},filters:{formatDate(e){let t=new Date(e+"+0800");return Object(n["a"])(t,"yyyy-MM-dd hh:mm")}},computed:{computed_choice(){return function(e){return this.choice.group}}},methods:{handleSelected(){this.refreshChart()},makeGroup(){for(var e in this.data.group)!0===this.data.multiple?this.choice[e]=[]:!1===this.data.multiple&&(this.choice[e]=0)},filter_option(e){var t=[];for(var a in this.data.options)this.data.options[a].group===e&&t.push({option:this.data.options[a],key:parseInt(a)});return t},filter_chart_option(e){var t=[];for(var a of this.data.options)a.group===e&&t.push(a);return t},refreshChart(){if(this.data.group.indexOf(this.selectedValue)>=0){let e=this.chart_template;e.series[0].data=this.filter_chart_option(this.selectedValue),this.chart_option=e}},detailStatic(){this.$store.dispatch("user/detail",this.$route.params.id).then(e=>{console.log(e),this.data=e,this.tableData=this.data.history,this.selectedValue=this.data.group[0],this.refreshChart(),this.makeGroup()}).catch(()=>{Object(r["Message"])({message:"无法获取目前开放的投票",type:"error",duration:2e3})})},handleChange(e){},handleResize(){window.addEventListener("resize",()=>{this.$refs.pie.resize()},!1)},handleVote(){console.log(this.choice),this.$store.state.user.choice=this.choice,this.$store.dispatch("user/submitVote",this.$route.params.id).then(()=>{Object(r["Message"])({message:"提交投票成功",type:"success",duration:2e3}),this.submitDisabled=!0}).catch(()=>{Object(r["Message"])({message:"提交投票失败,您可能已经投过",type:"error",duration:2e3})})}}}),u=d,p=(a("3e4a"),a("2877")),h=Object(p["a"])(u,o,l,!1,null,"6110128c",null),m=h.exports,_={name:"detail",components:{Detail:m}},v=_,f=Object(p["a"])(v,i,s,!1,null,null,null);t["default"]=f.exports}}]);
//# sourceMappingURL=chunk-9bebc408.05daaf1a.js.map