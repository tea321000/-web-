(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-942ede7c"],{"513b":function(e,t,a){},9158:function(e,t,a){"use strict";function s(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));let a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(let s in a){let e=a[s]+"";new RegExp(`(${s})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?e:i(e)))}return t}function i(e){return("00"+e).substr(e.length)}a.d(t,"a",function(){return s})},b5fb:function(e,t,a){"use strict";var s=a("513b"),i=a.n(s);i.a},c84b:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Detail")],1)},i=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"当前状态",name:"1"}},[!0===e.data.permission&&!0===e.data.time_limit&&"student"===e.roles[0]?a("div",[e._v("可以进行投票")]):"teacher"===e.roles[0]?a("div",[e._v("您是老师，不可进行投票")]):!1===e.data.permission?a("div",[e._v("您没有该投票的权限或已经投过票，不可投票")]):!1===e.data.time_limit?a("div",[e._v("投票时间已过或未开始，不可投票")]):e._e(),e.data.academy?a("div",[e._v("投票限制学院为：")]):e._e(),e._l(e.data.academy,function(t){return a("div",{key:t},[e._v(e._s(t))])}),e.data.grade?a("div",[e._v("投票限制年级为：")]):e._e(),e._l(e.data.grade,function(t){return a("div",{key:t},[e._v(e._s(t))])}),e.data.person?a("div",[e._v("投票限制个人为：")]):e._e(),e._l(e.data.person,function(t){return a("div",{key:t},[e._v(e._s(t))])}),e.data.anonymous?a("div",[e._v("该投票是匿名投票，将不显示投票历史")]):e._e()],2),a("el-collapse-item",{attrs:{title:"投票标题",name:"2"}},[a("div",[e._v(e._s(e.data.title))])]),e.data.content?a("el-collapse-item",{attrs:{title:"投票内容",name:"3"}},[a("div",[e._v(e._s(e.data.content))])]):e._e(),a("el-collapse-item",{attrs:{title:"投票时间",name:"4"}},[a("div",[e._v(e._s(e._f("formatDate")(e.data.time_start))+"至"+e._s(e._f("formatDate")(e.data.time_end)))])]),e.data.pic?a("el-collapse-item",{attrs:{title:"投票图片",name:"5"}},[a("img",{staticClass:"image",attrs:{src:e.data.pic}})]):e._e(),e.data.pic?a("el-collapse-item",{attrs:{title:"投票链接和二维码",name:"6"}},[a("div",[e._v("投票地址链接为:")]),a("a",{attrs:{href:e.qrLink}},[e._v(e._s(e.qrLink))]),a("div",[e._v("二维码:")]),a("qrcode",{attrs:{value:e.qrLink,options:{width:300}}})],1):e._e(),!1===e.data.anonymous&&e.data.history.length>0?a("el-collapse-item",{attrs:{title:"投票历史",name:"7"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"投票者学号"}},[a("span",[e._v(e._s(t.row.user_id))])]),a("el-form-item",{attrs:{label:"投票者姓名"}},[a("span",[e._v(e._s(t.row.user_name))])]),a("el-form-item",{attrs:{label:"投票选项"}},[a("span",[e._v(e._s(t.row.vote_content))])]),a("el-form-item",{attrs:{label:"当前该选项票数"}},[a("span",[e._v(e._s(t.row.vote_count))])])],1)]}}],null,!1,3332428280)}),a("el-table-column",{attrs:{label:"投票者学号",prop:"user_id"}}),a("el-table-column",{attrs:{label:"投票者姓名",prop:"user_name"}})],1)],1):e._e(),a("el-collapse-item",{attrs:{title:"投票选项及图表",name:"8"}},[!1===e.data.multiple?a("div",[!0===e.data.permission&&!0===e.data.time_limit?a("el-radio-group",{model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},e._l(e.data.options,function(t,s){return a("el-radio",{key:s,attrs:{label:s}},[e._v(e._s(t.name)+" 投票数量："+e._s(t.value))])}),1):a("el-radio-group",e._l(e.data.options,function(t,s){return a("el-radio",{attrs:{disable:"",label:s}},[e._v(e._s(t.name)+" 投票数量："+e._s(t.value))])}),1)],1):a("div",[!0===e.data.permission&&!0===e.data.time_limit?a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.data.options,function(t,s){return a("el-checkbox",{key:s,attrs:{label:s}},[e._v(e._s(t.name)+" 投票数量："+e._s(t.value))])}),1):a("el-checkbox-group",e._l(e.data.options,function(t,s){return a("el-checkbox",{attrs:{disable:"",label:s}},[e._v(e._s(t.name)+" 投票数量："+e._s(t.value))])}),1)],1),!0===e.data.permission&&!0===e.data.time_limit?a("el-button",{attrs:{type:"primary",disabled:e.submitDisabled},on:{click:e.handleVote}},[e._v("提交")]):e._e(),a("v-chart",{ref:"pie",attrs:{options:e.chart_option,"auto-resize":""}})],1)],1)],1)},r=[],o=a("5c96"),n=a("9158"),c=a("9ca8"),d=(a("c037"),{name:"detail",components:{"v-chart":c["a"]},created(){this.detailStatic(),this.handleResize()},data(){return{data:[],tableData:[],qrLink:window.location.href,activeNames:["1","2","3","4","5","6","7","8"],roles:this.$store.state.user.roles,radio:0,checkList:[],submitDisabled:!1,choice:[],chart_option:{title:{text:"投票图表",subtext:"",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:[]},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"投票图表",type:"pie",radius:"55%",center:["50%","60%"],data:[]}]}}},watch:{$route(e,t){"voteDetailPermission"===e.name&&this.detailStatic()}},filters:{formatDate(e){let t=new Date(e+"+0800");return Object(n["a"])(t,"yyyy-MM-dd hh:mm")}},methods:{detailStatic(){this.$store.dispatch("user/detail",this.$route.params.id).then(e=>{console.log(e),this.data=e,this.chart_option.series[0].data=this.data.options,this.tableData=this.data.history}).catch(()=>{Object(o["Message"])({message:"无法获取目前开放的投票",type:"error",duration:2e3})})},handleChange(e){console.log(e)},handleResize(){window.addEventListener("resize",()=>{this.$refs.pie.resize()},!1)},handleVote(){!0===this.data.multiple?(console.log(this.checkList),this.$store.state.user.choice=this.checkList,this.$store.dispatch("user/submitVote",this.$route.params.id).then(()=>{Object(o["Message"])({message:"提交投票成功",type:"success",duration:2e3}),this.submitDisabled=!0}).catch(()=>{Object(o["Message"])({message:"提交投票失败,您可能已经投过",type:"error",duration:2e3})})):!1===this.data.multiple&&(console.log(this.radio),this.$store.state.user.choice.push(this.radio),this.$store.dispatch("user/submitVote",this.$route.params.id).then(e=>{Object(o["Message"])({message:"提交投票成功",type:"success",duration:2e3}),console.log(e)}).catch(()=>{Object(o["Message"])({message:"提交投票失败",type:"error",duration:2e3})}))}}}),u=d,m=(a("b5fb"),a("2877")),p=Object(m["a"])(u,l,r,!1,null,"fba9674a",null),h=p.exports,_={name:"detail",components:{Detail:h}},v=_,b=Object(m["a"])(v,s,i,!1,null,null,null);t["default"]=b.exports}}]);
//# sourceMappingURL=chunk-942ede7c.54d155ea.js.map